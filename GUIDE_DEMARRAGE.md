# üß† MnemoLite - Guide de D√©marrage

> **Pour qui ?** Ce guide est fait pour vous si vous voulez installer et utiliser MnemoLite, m√™me sans √™tre expert en bases de donn√©es ou en Docker. On vous prend par la main, √©tape par √©tape.

---

## üìñ Introduction : Votre biblioth√®que personnelle intelligente

Imaginez une **biblioth√®que immense** o√π chaque livre repr√©sente un souvenir, une conversation, un √©v√©nement. Mais contrairement √† une biblioth√®que classique o√π vous devez conna√Ætre le titre exact pour trouver un livre, **MnemoLite** est comme une biblioth√®que magique :

- üîç **Vous cherchez par sens, pas par mot exact** : "Je cherche quelque chose sur les chats" trouvera aussi "f√©lin domestique" ou "mon minou"
- ‚è∞ **Vous pouvez filtrer par √©poque** : "Montre-moi tout ce qui s'est pass√© en janvier"
- üè∑Ô∏è **Vous pouvez classer par cat√©gories** : "Tous les souvenirs li√©s au projet Expanse"

**Le secret ?** MnemoLite utilise **PostgreSQL** comme biblioth√©caire ultra-comp√©tent et des **embeddings locaux** (des "empreintes digitales s√©mantiques") pour comprendre le sens de vos donn√©es, sans jamais envoyer quoi que ce soit sur Internet.

### üéØ Ce que vous obtiendrez

√Ä la fin de ce guide, vous aurez :
- ‚úÖ MnemoLite install√© et op√©rationnel sur votre machine
- ‚úÖ Compris comment stocker des √©v√©nements (vos "livres")
- ‚úÖ Appris √† rechercher dans vos donn√©es avec diff√©rentes strat√©gies
- ‚úÖ Une API pr√™te √† connecter √† vos projets

**Temps estim√©** : 15-20 minutes pour l'installation ‚è±Ô∏è

---

## üß∞ Avant de commencer : Votre bo√Æte √† outils

### Ce dont vous avez besoin

Pensez √† Docker comme √† une **machine virtuelle l√©g√®re** qui isole MnemoLite dans sa propre "bulle" sur votre ordinateur. C'est comme avoir plusieurs mini-ordinateurs dans votre ordinateur.

**Requis absolument** :
- **Docker Desktop** (Windows/Mac) ou **Docker Engine** (Linux) - [T√©l√©charger ici](https://docs.docker.com/get-docker/)
  - Version Docker Compose v2+ incluse
- **Git** - Pour t√©l√©charger le code - [T√©l√©charger ici](https://git-scm.com/downloads)
- **Un terminal** (Bash, PowerShell, Terminal Mac, etc.)
- **4 GB de RAM disponible** (minimum) - MnemoLite est gourmand mais pas excessif
- **5 GB d'espace disque libre** - Pour les images Docker et les donn√©es

**Bonus (optionnel mais pratique)** :
- **curl** - Pour tester l'API facilement (souvent d√©j√† install√©)
- **jq** - Pour formater joliment les r√©ponses JSON
- **Un √©diteur de texte** - VSCode, Sublime, nano, vim... au choix

### V√©rifier que tout est pr√™t

Ouvrez un terminal et tapez ces commandes pour v√©rifier :

```bash
# V√©rifier Docker
docker --version
# Devrait afficher quelque chose comme : Docker version 24.0.x

# V√©rifier Docker Compose
docker compose version
# Devrait afficher : Docker Compose version v2.x.x

# V√©rifier Git
git --version
# Devrait afficher : git version 2.x.x
```

‚úÖ **Tout fonctionne ?** Parfait, on peut continuer !
‚ùå **Quelque chose ne marche pas ?** Installez l'outil manquant avant de continuer.

---

## üöÄ Installation pas √† pas

### √âtape 1 : T√©l√©charger MnemoLite

Ouvrez un terminal et allez dans le dossier o√π vous voulez installer MnemoLite (par exemple `~/Projects` ou `C:\Projects`).

```bash
# T√©l√©charger le code
git clone https://github.com/giak/MnemoLite.git
cd MnemoLite
```

**Ce qui se passe** : Git t√©l√©charge tous les fichiers du projet dans un nouveau dossier `MnemoLite`.

### √âtape 2 : Configuration - Cr√©er votre fichier `.env`

Le fichier `.env` contient tous les param√®tres de configuration. Pensez-y comme aux **r√©glages personnels** de votre biblioth√®que.

```bash
# Copier le fichier d'exemple
cp .env.example .env
```

**Ouvrez le fichier `.env`** avec votre √©diteur de texte favori. Voici les param√®tres importants :

```bash
# === Configuration PostgreSQL (votre biblioth√©caire) ===
POSTGRES_USER=mnemo                    # Nom d'utilisateur de la base de donn√©es
POSTGRES_PASSWORD=mnemopass            # ‚ö†Ô∏è CHANGEZ √áA en production !
POSTGRES_DB=mnemolite                  # Nom de votre biblioth√®que
POSTGRES_PORT=5432                     # Port interne (laissez par d√©faut)

# === Configuration API ===
API_PORT=8001                          # Port pour acc√©der √† l'API
                                       # http://localhost:8001

# === Configuration Embeddings (100% local) ===
EMBEDDING_MODEL=nomic-ai/nomic-embed-text-v1.5  # Le mod√®le d'IA local
EMBEDDING_DIMENSION=768                         # Taille des vecteurs

# === Environnement ===
ENVIRONMENT=development                # development ou production
```

**üí° Conseil** : Pour un premier test, vous pouvez garder les valeurs par d√©faut. En production, **changez absolument le mot de passe** !

### √âtape 3 : Construire et lancer MnemoLite

Deux options : utiliser le **Makefile** (plus simple) ou **Docker Compose directement**.

#### Option A : Avec Make (recommand√©)

```bash
# D√©marrer tous les services
make up

# V√©rifier que tout roule
make ps
```

#### Option B : Sans Make (Docker Compose direct)

```bash
# Construire les images
docker compose build

# D√©marrer les services
docker compose up -d
```

**Ce qui se passe** :
1. üèóÔ∏è Docker construit 3 "bo√Ætes" (containers) :
   - **mnemo-postgres** : Votre base de donn√©es PostgreSQL avec les extensions magiques (pgvector, pg_partman)
   - **mnemo-api** : L'API FastAPI qui r√©pond √† vos requ√™tes HTTP
   - **mnemo-worker** : Un travailleur en arri√®re-plan pour les t√¢ches lourdes (optionnel)

2. ‚è≥ **Premi√®re fois = plus long** : Docker t√©l√©charge les images de base (Python, PostgreSQL) et installe toutes les d√©pendances. Comptez 5-10 minutes.

3. üì¶ Au premier d√©marrage, PostgreSQL initialise la base de donn√©es avec les scripts dans `db/init/`.

### √âtape 4 : V√©rifier que tout fonctionne

```bash
# Voir l'√©tat des containers
docker compose ps
# Tous doivent √™tre "Up" ou "Up (healthy)"

# Tester la sant√© de l'API
curl http://localhost:8001/v1/health
```

**R√©ponse attendue** :
```json
{
  "status": "ok",
  "checks": {
    "database": true
  },
  "timestamp": "2025-10-12T20:00:00Z"
}
```

üéâ **√áa marche ?** F√©licitations ! MnemoLite est op√©rationnel !

---

## üéÆ Premiers pas : Utiliser MnemoLite

Maintenant que votre biblioth√®que est ouverte, apprenons √† y ajouter des livres (√©v√©nements) et √† les retrouver.

### 1. Ajouter votre premier √©v√©nement

Un **√©v√©nement** dans MnemoLite, c'est comme une **fiche dans votre biblioth√®que** avec :
- üìù **content** : Le contenu principal (le texte du livre)
- üè∑Ô∏è **metadata** : Des √©tiquettes pour classer (genre, auteur, projet...)
- üß¨ **embedding** (optionnel) : L'empreinte s√©mantique (g√©n√©r√©e automatiquement si vous ne la fournissez pas)

```bash
curl -X POST http://localhost:8001/v1/events \
  -H "Content-Type: application/json" \
  -d '{
    "content": {
      "text": "R√©union de lancement du projet Expanse. Objectif : cr√©er un agent conversationnel intelligent."
    },
    "metadata": {
      "type": "meeting",
      "project": "Expanse",
      "participants": ["Alice", "Bob", "Charlie"]
    }
  }'
```

**Ce qui se passe** :
1. MnemoLite re√ßoit votre √©v√©nement
2. Il extrait le texte : "R√©union de lancement..."
3. Il g√©n√®re automatiquement un **embedding 768-dimensions** avec le mod√®le local (nomic-embed-text-v1.5)
4. Il stocke tout dans PostgreSQL avec un index vectoriel HNSW pour recherche ultra-rapide

**R√©ponse** :
```json
{
  "id": "123e4567-e89b-12d3-a456-426614174000",
  "timestamp": "2025-10-12T14:30:00Z",
  "content": { "text": "R√©union de lancement..." },
  "metadata": { "type": "meeting", "project": "Expanse", ... },
  "embedding": [0.123, -0.456, 0.789, ...], // 768 valeurs
  "created_at": "2025-10-12T14:30:00Z"
}
```

### 2. Rechercher par sens (recherche vectorielle)

La **magie des embeddings** : cherchez par le sens, pas par les mots exacts !

```bash
curl -G http://localhost:8001/v1/search/ \
  --data-urlencode "vector_query=agent conversationnel intelligent" \
  --data-urlencode "limit=5" \
  -H "Accept: application/json"
```

**Ce qui se passe** :
1. MnemoLite transforme votre requ√™te "agent conversationnel intelligent" en embedding
2. Il cherche dans la base les √©v√©nements avec les embeddings **les plus proches** (cosinus similarity)
3. Il retourne les 5 r√©sultats les plus pertinents

**R√©sultat** : Votre √©v√©nement "R√©union de lancement du projet Expanse" sera trouv√©, m√™me si les mots ne sont pas exactement les m√™mes !

### 3. Recherche hybride (vecteur + m√©tadonn√©es)

Combinez la recherche s√©mantique avec des filtres pr√©cis :

```bash
curl -G http://localhost:8001/v1/search/ \
  --data-urlencode 'vector_query=projet intelligence artificielle' \
  --data-urlencode 'filter_metadata={"project":"Expanse"}' \
  --data-urlencode "limit=10" \
  -H "Accept: application/json"
```

**Ce qui se passe** : "Trouve-moi tout ce qui parle d'IA **ET** qui est li√© au projet Expanse"

### 3.5 üéØ Optimiser la pr√©cision avec le seuil de distance (distance_threshold)

Le param√®tre **`distance_threshold`** contr√¥le √† quel point les r√©sultats doivent √™tre **similaires** √† votre requ√™te. C'est comme r√©gler la "sensibilit√©" de votre recherche.

**Comment √ßa marche ?**
- MnemoLite utilise la **distance L2** (Euclidienne) entre les embeddings
- Plus la distance est **petite**, plus les r√©sultats sont **proches** s√©mantiquement
- La plage va de **0 √† 2** (pour des vecteurs normalis√©s)

**Valeurs recommand√©es** :

| Valeur | Mode | Usage | R√©sultats attendus |
|--------|------|-------|-------------------|
| **0.8** | Strict | Haute pr√©cision | Peu de r√©sultats, tr√®s pertinents |
| **1.0** | √âquilibr√© (d√©faut) | Usage g√©n√©ral | Bon compromis pr√©cision/rappel |
| **1.2** | Relax | Haute couverture | Plus de r√©sultats, pertinence √©largie |
| **None** ou **2.0** | Top-K | Sans filtrage | K r√©sultats les plus proches |

**Exemple - Recherche stricte** :
```bash
curl -G http://localhost:8001/v1/search/ \
  --data-urlencode 'vector_query=erreur critique syst√®me' \
  --data-urlencode "distance_threshold=0.8" \
  --data-urlencode "limit=5" \
  -H "Accept: application/json"
```

**Exemple - Recherche large** :
```bash
curl -G http://localhost:8001/v1/search/ \
  --data-urlencode 'vector_query=projet IA' \
  --data-urlencode "distance_threshold=1.2" \
  --data-urlencode "limit=10" \
  -H "Accept: application/json"
```

**üõ°Ô∏è Protection automatique (Adaptive Fallback)** :

Si votre `distance_threshold` est trop strict et retourne **0 r√©sultats**, MnemoLite active automatiquement le **mode fallback** :
- Il r√©essaie la recherche **sans threshold** (mode top-K)
- Vous obtenez les K r√©sultats les plus proches, garantis
- Un avertissement est logu√© pour vous informer

**Conditions du fallback** :
- ‚úÖ Recherche vectorielle pure (pas de filtres metadata ou time)
- ‚úÖ Threshold d√©fini ET 0 r√©sultats obtenus
- ‚úÖ Fallback activ√© par d√©faut (`enable_fallback=true`)

**Exemple de log** :
```
WARNING: Vector search with threshold 0.5 returned 0 results.
Falling back to top-K mode (no threshold).
```

**üí° Conseil pratique** :
- **Commencez avec 1.0** (valeur par d√©faut) et ajustez selon vos besoins
- **0.8 ou moins** : R√©serv√© aux recherches tr√®s sp√©cifiques (ex: d√©tection de doublons)
- **1.2 ou plus** : Pour des recherches exploratoires larges

### 4. Recherche par p√©riode (time-based)

Gr√¢ce au **partitionnement automatique** (pg_partman), les recherches temporelles sont ultra-rapides :

```bash
curl -G http://localhost:8001/v1/search/ \
  --data-urlencode 'filter_metadata={"project":"Expanse"}' \
  --data-urlencode "ts_start=2025-10-01T00:00:00Z" \
  --data-urlencode "ts_end=2025-10-31T23:59:59Z" \
  --data-urlencode "limit=20" \
  -H "Accept: application/json"
```

**Ce qui se passe** : PostgreSQL utilise le **partition pruning** - il ne regarde que les partitions (tables) du mois d'octobre, ignorant le reste. R√©sultat : recherche en ~3ms !

---

## üé® Interface Web (Bonus)

MnemoLite inclut une **interface Web l√©g√®re** (HTMX) pour explorer visuellement vos donn√©es.

Ouvrez simplement votre navigateur : **http://localhost:8001/**

Vous pourrez :
- üìä Visualiser vos √©v√©nements
- üîç Faire des recherches avec des filtres
- üìà Voir des statistiques
- üß™ Tester l'API interactivement

**Documentation API interactive** :
- **Swagger UI** : http://localhost:8001/docs
- **ReDoc** : http://localhost:8001/redoc

---

## üêõ D√©pannage : Quand √ßa ne marche pas

### Probl√®me 1 : "Cannot connect to Docker daemon"

**Sympt√¥me** : `Cannot connect to the Docker daemon at unix:///var/run/docker.sock`

**Solution** :
```bash
# V√©rifier que Docker est lanc√©
docker info

# Si erreur, d√©marrer Docker Desktop (Mac/Windows)
# ou d√©marrer le service (Linux)
sudo systemctl start docker
```

### Probl√®me 2 : "Port 8001 already in use"

**Sympt√¥me** : `Bind for 0.0.0.0:8001 failed: port is already allocated`

**Solution** : Changez le port dans `.env`
```bash
# √âditez .env et changez :
API_PORT=8002  # ou n'importe quel port libre
```

Puis relancez :
```bash
docker compose down
docker compose up -d
```

### Probl√®me 3 : Container "mnemo-postgres" en √©tat "Restarting"

**Sympt√¥me** : `docker compose ps` montre que postgres red√©marre en boucle

**Solution** : V√©rifier les logs
```bash
docker logs mnemo-postgres

# Si probl√®me de m√©moire partag√©e, ajustez shm_size dans docker-compose.yml
# Si probl√®me de permissions, supprimez le volume et recommencez :
docker compose down -v
docker compose up -d
```

### Probl√®me 4 : "ModuleNotFoundError" dans l'API

**Sympt√¥me** : Erreur Python lors du d√©marrage de l'API

**Solution** : Reconstruire l'image
```bash
# Rebuild complet sans cache
docker compose build --no-cache api
docker compose up -d
```

### Probl√®me 5 : Embeddings lents au premier appel

**Normal** ! Au premier appel, le mod√®le `nomic-embed-text-v1.5` est t√©l√©charg√© (~1 GB) et charg√© en m√©moire. Ensuite, c'est ultra-rapide (~30ms en moyenne).

**Suivre le t√©l√©chargement** :
```bash
docker logs -f mnemo-api
# Vous verrez : "Downloading model..."
```

---

## ‚ùì FAQ : Questions fr√©quentes

### Q1 : Est-ce que mes donn√©es sortent de ma machine ?

**R√©ponse** : NON ! MnemoLite est **100% local**. Aucune donn√©e ne sort de votre ordinateur. Les embeddings sont g√©n√©r√©s localement avec Sentence-Transformers, sans appel API externe.

### Q2 : Combien d'√©v√©nements puis-je stocker ?

**R√©ponse** : Des millions ! Gr√¢ce au partitionnement automatique (pg_partman), PostgreSQL g√®re efficacement des volumes massifs. Avec 50 000 √©v√©nements, les recherches sont d√©j√† √† ~12ms P95.

### Q3 : Puis-je utiliser MnemoLite en production ?

**R√©ponse** : Oui, mais :
1. **Changez les mots de passe** dans `.env`
2. Configurez des sauvegardes r√©guli√®res (`make db-backup`)
3. Ajustez les ressources Docker (`docker-compose.yml` > `deploy.resources.limits`)
4. Utilisez HTTPS avec un reverse proxy (nginx, traefik)

### Q4 : Comment sauvegarder mes donn√©es ?

```bash
# Sauvegarde manuelle
make db-backup

# Ou avec Docker directement
docker exec mnemo-postgres pg_dump -U mnemo mnemolite > backup_$(date +%Y%m%d).sql
```

### Q5 : Puis-je changer le mod√®le d'embeddings ?

**R√©ponse** : Oui ! √âditez `.env` :
```bash
EMBEDDING_MODEL=sentence-transformers/all-MiniLM-L6-v2  # Plus petit, plus rapide
EMBEDDING_DIMENSION=384  # Adapter selon le mod√®le
```

**Attention** : Si vous changez de mod√®le, les embeddings existants deviennent incompatibles. Il faut r√©g√©n√©rer tous les embeddings ou repartir d'une base vierge.

### Q6 : Comment arr√™ter MnemoLite ?

```bash
# Arr√™ter les containers (donn√©es conserv√©es)
docker compose stop

# Arr√™ter ET supprimer les containers (donn√©es dans volumes conserv√©es)
docker compose down

# Tout supprimer (containers + volumes = perte de donn√©es !)
docker compose down -v
```

### Q7 : Est-ce que je peux connecter mon agent IA (LangChain, LlamaIndex, etc.) ?

**Absolument !** MnemoLite expose une API REST standard. Exemples :
- **LangChain** : Utilisez `requests` pour appeler `/v1/events` et `/v1/search`
- **LlamaIndex** : Int√©grez comme un `VectorStore` custom
- **Expanse** : C'est justement fait pour √ßa ! üéØ

---

## üéì Aller plus loin

Maintenant que vous ma√Ætrisez les bases, explorez :

- üìñ [Architecture D√©taill√©e](docs/Document%20Architecture.md) - Comprendre comment tout fonctionne
- üîß [Sp√©cification API Compl√®te](docs/Specification_API.md) - Tous les endpoints en d√©tail
- üèóÔ∏è [Sch√©ma de Base de Donn√©es](docs/bdd_schema.md) - Tables, indexes, partitions
- üê≥ [Configuration Docker Avanc√©e](docs/docker_setup.md) - Tuning et optimisations
- üî¨ [Tests et Benchmarks](tests/README.md) - Performance et qualit√©

---

## ü§ù Besoin d'aide ?

- üêõ **Bug ou probl√®me** : Ouvrez une issue sur GitHub
- üí° **Question** : Consultez les docs ou demandez sur les discussions GitHub
- üöÄ **Contribution** : Les Pull Requests sont bienvenues !

---

**Bienvenue dans l'univers MnemoLite !** üß†‚ú®

Vous avez maintenant votre propre biblioth√®que cognitive locale, pr√™te √† alimenter vos agents IA. Explorez, exp√©rimentez, et amusez-vous !

*Guide r√©dig√© avec ‚ù§Ô∏è pour rendre MnemoLite accessible √† tous.*

---

**Version** : 1.0.0
**Derni√®re mise √† jour** : 2025-10-12
**Auteur** : Giak
